<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title></title>
    <style>
    .container {
        position: relative;
        width: 90%;
        background: gray;
        margin: 0 auto;
        height: 1000px;
        overflow: hidden;
    }
    
    .container>div {
        position: absolute;
        width: 220px;
        box-sizing: border-box;
        padding: 5px;
        background: #fff;
    }
    
    .container>div img {
        width: 100%;
        display: block;
    }
    
    div[data-status='1'] {
        left: 10px;
    }
    
    div[data-status='2'] {
        left: 240px;
    }
    
    div[data-status='3'] {
        left: 470px;
    }
    
    div[data-status='4'] {
        left: 700px;
    }
    
    div[data-status='5'] {
        left: 930px;
    }
    </style>
</head>

<body>
    <div class="container">
    </div>
    <script>
    Array.prototype.min = function() {
        var obj = {
            index: 0,
            val: this[0]
        };
        var len = this.length;
        for (var i = 0; i < len; i++) {
            if (obj.val > this[i]) {
                obj.index = i;
                obj.val = this[i];
            }
        }
        return obj;
    }
    Array.prototype.max = function() {
        var obj = {
            index: 0,
            val: this[0]
        };
        var len = this.length;
        for (var i = 0; i < len; i++) {
            if (obj.val < this[i]) {
                obj.index = i;
                obj.val = this[i];
            }
        }
        return obj;
    }
    var pubuliu = {
        itemWidth: 220,
        totalWidth: 0,
        cellCount: 0,
        heightArr: [],
        leftArr: [],
        data: [],
        marginWidth: 0,
        getContainerWidth: function() {
            var element = document.querySelector('.container');
            var width = window.getComputedStyle(element, null).width;
            return parseInt(width);
        },
        init: function() {
            var self = this;
            for (var i = 1; i < 50; i++) {
                self.data.push(i);
            }
            this.computePosition();
            this.bindEvent();
        },
        computePosition: function() {
        	this.initData();
            this.getData();
        },
        initData: function() {
            this.totalWidth = this.getContainerWidth();
            this.cellCount = parseInt(this.totalWidth / this.itemWidth);
            this.marginWidth = (this.totalWidth - this.cellCount * this.itemWidth) / (this.cellCount + 1);
            while (this.marginWidth < 5) {
                this.cellCount = this.cellCount - 1;
                this.marginWidth = (this.totalWidth - this.cellCount * this.itemWidth) / (this.cellCount + 1);
            }
            for (var i = 0; i < this.cellCount; i++) {
                this.leftArr.push((this.marginWidth + this.itemWidth) * i + this.marginWidth);
                this.heightArr.push(this.marginWidth);
            }
        },
        resetPosition: function() {
            var self=this;
            this.totalWidth = this.getContainerWidth();
             this.heightArr=[];
             this.leftArr=[];
            this.cellCount = parseInt(this.totalWidth / this.itemWidth);
            this.marginWidth = (this.totalWidth - this.cellCount * this.itemWidth) / (this.cellCount + 1);
            while (self.marginWidth < 5) {
                self.cellCount = self.cellCount - 1;
                self.marginWidth = (self.totalWidth - self.cellCount * self.itemWidth) / (self.cellCount + 1);
            }
            for (var i = 0; i < self.cellCount; i++) {
                self.leftArr.push((self.marginWidth + self.itemWidth) * i + self.marginWidth);
                self.heightArr.push(self.marginWidth);
            }
            var itemArray = document.querySelectorAll('.container .item');
            for (var i = 0; i < itemArray.length; i++) {
                 var minObj = self.heightArr.min();
                itemArray[i].style.top = minObj.val + 'px';
                 itemArray[i].style.left = self.leftArr[minObj.index] + 'px';
                 var height=parseInt(itemArray[i].getAttribute('height-num'));
                 //  var height = img.height * 220 / width;
                  self.heightArr[minObj.index] = self.heightArr[minObj.index] + height + self.marginWidth;
                var maxObj = self.heightArr.max();
                document.querySelector('.container').style.height = maxObj.val + 20 + 'px';
            }
        },
        getData: function() {
            var self = this;            
            self.data.forEach(function(item, index) {
                var url = item + '.jpg';
                self.loadImage(url, self.rander.bind(self));
            });

        },
        loadImage: function(url, callback) {
            var img = new Image();
            img.onload = function() {
                img.onload = null;
                var width = img.width;
                var height = img.height * 220 / width;
                callback(img.src, height);
            }
            img.src = url;
        },
        rander: function(url, height) {
            var minObj = this.heightArr.min();
            var div = document.createElement('DIV');
            div.className = 'item';
            div.setAttribute('height-num',height);
            div.style.top = minObj.val + 'px';
            div.style.left = this.leftArr[minObj.index] + 'px';
            //div.setAttribute('data-status', minObj.index + 1 + '');
            div.innerHTML = '<img src="' + url + '" alt="">';
            document.querySelector('.container').appendChild(div);
            this.heightArr[minObj.index] = this.heightArr[minObj.index] + height + this.marginWidth;
            var maxObj = this.heightArr.max();
            document.querySelector('.container').style.height = maxObj.val + 20 + 'px';
        },
        bindEvent: function() {
            var firstOnResizeFire = true; //谷歌浏览器onresize事件会执行2次，这里加个标志位控制  
            var self = this;
            window.onresize = function() {
                self.resetPosition();
                // if (firstOnResizeFire) {
                //    // NfLayout.tabScrollerMenuAdjust(homePageWidth);
                //     firstOnResizeFire = false;
                //     self.computePosition();
                //     //0.5秒之后将标志位重置（Chrome的window.onresize默认执行两次）  
                //     setTimeout(function() {
                //         firstOnResizeFire = true;
                //     }, 500);
                // }

                // homePageWidth = document.body.clientWidth; //重新保存一下新宽度  
            }
        }
    };
    pubuliu.init();
    // var data = [];
    // var itemWidth = 220;

    // function getContainerWidth() {
    //     var element = document.querySelector('.container');
    //     var width = window.getComputedStyle(element, null).width;
    //     return parseInt(width);
    // }
    // var totalWidth = getContainerWidth();
    // var cellCount = parseInt(totalWidth / itemWidth);
    // var heightArr = [];
    // var marginWidth = (totalWidth - cellCount * itemWidth) / (cellCount + 1);
    // var leftArr = [];
    // for (var i = 0; i < cellCount; i++) {
    //     leftArr.push((marginWidth + itemWidth) * i + marginWidth);
    //     heightArr.push(marginWidth);
    // }


    // for (var i = 1; i < 50; i++) {
    //     data.push(i);
    // }

    // function loadImage(url, callback) {
    //     var img = new Image();
    //     img.onload = function() {
    //         img.onload = null;
    //         var width = img.width;
    //         var height = img.height * 220 / width;
    //         callback(img.src, height);
    //     }
    //     img.src = url;
    // }

    // function rander(url, height) {
    //     var minObj = heightArr.min();
    //     var div = document.createElement('DIV');
    //     div.className = 'item';
    //     div.style.top = minObj.val + 'px';
    //     div.style.left = leftArr[minObj.index] + 'px';
    //     //div.setAttribute('data-status', minObj.index + 1 + '');
    //     div.innerHTML = '<img src="' + url + '" alt="">';
    //     document.querySelector('.container').appendChild(div);
    //     heightArr[minObj.index] = heightArr[minObj.index] + height + 10;
    //     var maxObj = heightArr.max();
    //     document.querySelector('.container').style.height = maxObj.val + 20 + 'px';
    // }
    // data.forEach(function(item, index) {
    //     var url = item + '.jpg';
    //     loadImage(url, rander);
    // })
    </script>
</body>

</html>
